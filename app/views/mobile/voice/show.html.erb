<div class="flex-1 flex flex-col" data-controller="voice" data-voice-session-state-value="<%= @session.state %>" data-voice-current-entry-id-value="<%= @session.current_entry&.id %>">
  <!-- Status Area -->
  <div id="status-area" class="bg-gray-800 px-4 py-3">
    <% if @session.voice_recording %>
      <p class="text-sm text-gray-400">Working on:</p>
      <p class="text-lg font-medium"><%= @session.voice_recording.title %></p>
      <% if @session.current_entry %>
        <p class="text-sm text-green-400">
          Segment <%= entry_position(@session) %> of <%= @session.voice_recording.dictionary_entries.count %>
        </p>
      <% end %>
    <% else %>
      <p class="text-lg text-center text-gray-400">Ready to help you review recordings</p>
    <% end %>
  </div>

  <!-- Conversation Display -->
  <div id="conversation" class="flex-1 overflow-y-auto px-4 py-4 space-y-4" data-voice-target="conversation">
    <% @session.recent_history.each do |message| %>
      <div class="<%= message['role'] == 'user' ? 'text-right' : 'text-left' %>">
        <div class="inline-block max-w-[80%] px-4 py-2 rounded-lg <%= message['role'] == 'user' ? 'bg-blue-600' : 'bg-gray-700' %>">
          <%= message['content'] %>
        </div>
      </div>
    <% end %>

    <% if @session.idle? %>
      <div class="text-center text-gray-400 py-8">
        <p class="text-lg mb-4">Say something like:</p>
        <p class="text-green-400 mb-2">"Get me a random recording"</p>
        <p class="text-green-400 mb-2">"Find recordings about fishing"</p>
        <p class="text-green-400">"Continue where I left off"</p>
      </div>
    <% end %>
  </div>

  <!-- Current Segment Display -->
  <% if @session.current_entry %>
    <div id="segment-display" class="bg-gray-800 px-4 py-4 border-t border-gray-700">
      <div class="mb-3">
        <p class="text-xs text-gray-500 uppercase tracking-wide">Irish</p>
        <p class="text-xl text-green-400" data-voice-target="transcription">
          <%= @session.current_entry.word_or_phrase %>
        </p>
      </div>
      <div>
        <p class="text-xs text-gray-500 uppercase tracking-wide">English</p>
        <p class="text-lg text-gray-300" data-voice-target="translation">
          <%= @session.current_entry.translation %>
        </p>
      </div>

      <!-- Audio Controls -->
      <div class="flex gap-3 mt-4">
        <button data-action="click->voice#playOriginal"
                data-entry-id="<%= @session.current_entry.id %>"
                class="flex-1 bg-gray-700 py-3 rounded-lg text-center">
          Play Original
        </button>
        <button data-action="click->voice#speakIrish"
                class="flex-1 bg-green-700 py-3 rounded-lg text-center">
          Speak Irish
        </button>
      </div>
    </div>
  <% end %>

  <!-- Voice Input Area -->
  <div class="bg-gray-800 px-4 py-4 border-t border-gray-700">
    <!-- Quick Actions -->
    <% unless @session.voice_recording %>
      <div class="flex gap-2 mb-4">
        <%= button_to "Random Recording", random_recording_mobile_voice_path,
            method: :post,
            class: "flex-1 bg-green-600 py-2 rounded-lg text-center text-sm" %>
      </div>
    <% end %>

    <!-- Voice Button -->
    <div class="flex justify-center">
      <button data-action="click->voice#toggleRecording"
              data-voice-target="recordButton"
              class="w-20 h-20 rounded-full bg-red-600 flex items-center justify-center
                     transition-all duration-200 hover:bg-red-500 active:scale-95">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
          <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
        </svg>
      </button>
    </div>
    <p class="text-center text-gray-500 text-sm mt-2" data-voice-target="status">
      Tap to speak
    </p>
  </div>

  <!-- Hidden audio elements -->
  <audio id="original-audio" data-voice-target="originalAudio"></audio>
  <audio id="tts-audio" data-voice-target="ttsAudio"></audio>
</div>

<%= turbo_stream_from "voice_session_#{current_session.id}" %>
