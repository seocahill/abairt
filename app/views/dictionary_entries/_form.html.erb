<%= form_with(model: dictionary_entry, 
               class: "contents", 
               html: { 
                 multipart: true,
                 id: "practice_recording_form_#{dictionary_entry.id || 'new'}"
               },
               ) do |form| %>
  <% if dictionary_entry.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
      <h2><%= pluralize(dictionary_entry.errors.count, "error") %> prohibited this dictionary_entry from being saved:</h2>
      <ul>
        <% dictionary_entry.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="my-5" data-rang-target="wordSearch">
    <%= form.label :word_or_phrase %>
    <%= form.text_area :word_or_phrase, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full", id: "autoComplete", rows: 2 %>
  </div>

  <div class="my-5">
    <%= form.label :translation %>
    <%= form.text_area :translation, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full", id: "translation", rows: 2 %>
  </div>

  <%= form.hidden_field :dictionary_entry_id, id: "dictionary_entry_id" %>

  <div class="my-5">
    <div class="mt-3 bg-gray-50 border border-gray-200 rounded-lg p-4" 
         data-controller="audio-recorder direct-upload">
      
      <%= form.file_field :media, 
          hidden: true, 
          direct_upload: true,
          data: { 
            target: "direct-upload.input"
          } %>
      
      <!-- Recording Controls -->
      <div class="flex flex-wrap gap-3 justify-center sm:justify-start items-center mb-4">
        <button type="button" 
                class="inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors disabled:opacity-50"
                data-audio-recorder-target="recordButton" 
                data-action="audio-recorder#record">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
          </svg>
          Record
        </button>
        
        <button type="button" 
                class="inline-flex items-center px-4 py-2 bg-gray-600 text-white text-sm font-medium rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors disabled:opacity-50"
                data-audio-recorder-target="stopButton" 
                data-action="audio-recorder#stop"
                style="display: none;">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
          </svg>
          Stop
        </button>
        
        <button type="button" 
                class="inline-flex items-center px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-lg hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-colors disabled:opacity-50"
                data-action="audio-recorder#cancel">
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
          Cancel
        </button>
      </div>
      
      <!-- Status and Progress -->
      <div class="text-sm text-gray-600 mb-2">
        Recording Status: <span data-audio-recorder-target="status">Ready</span>
      </div>
      
      <!-- Upload Progress UI (matches existing direct-upload controller) -->
      <div class="relative pt-1 uploader">
        <div class="flex mb-2 items-center justify-between">
          <div>
            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200 file-name">
              No recording
            </span>
          </div>
          <div class="text-right">
            <span class="text-xs font-semibold inline-block text-blue-600 percentage-uploaded">
              0%
            </span>
          </div>
        </div>
        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200 progress">
          <div style="width:0%" class="progress-bar shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="my-5">
    <%= form.submit "Save entry", class: "rounded-lg py-3 px-5 bg-blue-600 text-white inline-block font-medium cursor-pointer hover:bg-blue-700 transition-colors w-full sm:w-auto" %>
    <%= link_to 'Cancel', dictionary_entries_path, class: "rounded-lg py-3 px-5 bg-gray-600 text-white inline-block font-medium cursor-pointer hover:bg-gray-700 transition-colors w-full sm:w-auto" %>
  </div>
<% end %>
