<!-- Main Container -->
<div class="flex flex-col md:flex-row min-h-screen">
  <!-- Left Side - Tags -->
  <div class="w-full md:w-1/3 bg-white border-r" data-controller="collapse">
    <!-- Mobile Toggle -->
    <button class="w-full md:hidden flex items-center justify-between p-6 border-b"
            data-action="collapse#toggle">
      <div class="flex items-center">
        <h2 class="text-xl font-semibold text-gray-900">Tags</h2>
        <span class="ml-2 text-sm text-gray-500"><%= @tags.count %> tags</span>
      </div>
      <svg data-collapse-target="icon" class="w-5 h-5 text-gray-500 transform transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>

    <!-- Tags Content (hidden by default on mobile) -->
    <div class="hidden md:block" data-collapse-target="content">
      <div class="p-6">
        <!-- Tag Search -->
        <div data-controller="tag-filter">
          <div class="relative">
            <input type="text"
                   placeholder="Filter tags..."
                   class="w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                   data-tag-filter-target="input"
                   data-action="input->tag-filter#filter">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
              </svg>
            </div>
          </div>

          <!-- Tag List -->
          <div class="mt-6 space-y-1 max-h-[calc(100vh-200px)] overflow-y-auto">
            <% if params[:tag].present? %>
              <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-blue-700">Filtered by: <%= params[:tag] %></span>
                  <%= link_to dictionary_entries_path(search: params[:search], media: params[:media], show_all: params[:show_all]),
                      class: "text-xs text-blue-600 hover:text-blue-800 underline" do %>
                    Clear filter
                  <% end %>
                </div>
              </div>
            <% end %>
            <% @tags.each do |tag| %>
              <%= link_to dictionary_entries_path(tag: tag.name, search: params[:search], media: params[:media], show_all: params[:show_all]),
                  class: "flex items-center justify-between px-4 py-2 rounded-lg hover:bg-gray-50 #{params[:tag] == tag.name ? 'bg-blue-50 text-blue-700' : 'text-gray-700'}",
                  data: { tag_filter_target: "tag" } do %>
                <span class="text-sm font-medium"><%= tag.name %></span>
                <span class="text-xs text-gray-500"><%= tag.taggings_count %></span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Side - Entries -->
  <div class="w-full md:w-2/3 h-screen flex flex-col">
    <!-- Search Header -->
    <div class="p-6 bg-white border-b">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-900">Dictionary Entries</h2>
        <% if current_user %>
          <%= link_to new_dictionary_entry_path,
              class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" do %>
            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
            New Entry
          <% end %>
        <% end %>
      </div>

      <div class="mt-4">
        <%= form_tag dictionary_entries_path, method: :get,
            data: { controller: "form" } do %>
          <div class="relative">
            <%= text_field_tag :search, params[:search],
                placeholder: "Search dictionary entries...",
                class: "w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                data: { action: "input->form#submit" } %>
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
              </svg>
            </div>
            <%= hidden_field_tag :tag, params[:tag] if params[:tag].present? %>
          </div>

          <!-- Show All Toggle -->
          <div class="mt-3 flex items-center">
            <%= check_box_tag :show_all, "1", params[:show_all] == "1",
                class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",
                data: { action: "change->form#submit" },
                include_hidden: true %>
            <%= label_tag :show_all, "Show all entries (including machine-generated, unreviewed transcriptions)",
                class: "ml-2 text-sm text-gray-600" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Entries List -->
    <div class="flex-1 overflow-y-auto p-6">
      <%= turbo_frame_tag "entries" do %>
        <div class="space-y-4" id="entries-container">
          <%= render partial: "dictionary_entry",
                     collection: @dictionary_entries,
                     as: :entry,
                     locals: { current_user: current_user } %>
        </div>

        <!-- Pagination -->
        <% if @pagy.pages > 1 %>
          <div class="mt-6 border-t border-gray-200 pt-6 flex items-center justify-between">
            <div class="text-sm text-gray-700">
              Showing <span class="font-medium"><%= @pagy.from %></span> to
              <span class="font-medium"><%= @pagy.to %></span> of
              <span class="font-medium"><%= @pagy.count %></span> entries
            </div>
            <div class="flex space-x-2">
              <% if @pagy.prev %>
                <%= link_to "Previous", dictionary_entries_path(page: @pagy.prev, search: params[:search], tag: params[:tag], media: params[:media], show_all: params[:show_all]),
                    class: "px-4 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",
                    data: { turbo_frame: "entries" } %>
              <% end %>
              <% if @pagy.next %>
                <%= link_to "Next", dictionary_entries_path(page: @pagy.next, search: params[:search], tag: params[:tag], media: params[:media], show_all: params[:show_all]),
                    class: "px-4 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",
                    data: { turbo_frame: "entries" } %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
